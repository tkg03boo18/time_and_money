<h1>Plans</h1>

<table>
  <thead>
    <tr>

      <th>Title</th>
      <th>Description</th>
      <th>Start date</th>
      <th>End date</th>
      <th>Allday</th>
      <th colspan="3"></th>

    </tr>
  </thead>

  <tbody id="plan-tbody">
    <% @plans.each do |plan| %>
      <tr>

        <td><%= plan.title %></td>
        <td><%= plan.description %></td>
        <td><%= plan.start_date %></td>
        <td><%= plan.end_date %></td>
        <td><%= plan.allday %></td>
        <td><%= link_to 'Show', plan %></td>
        <td><%= link_to 'Edit', edit_plan_path(plan) %></td>
        <td><%= link_to 'Destroy', plan, method: :delete, data: { confirm: 'Are you sure?' } %></td>

      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Plan', new_plan_path, remote: true, class: "btn btn-lg btn-primary" %>
<div id="plan-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>
<div id="calendar"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      if (calendarEl !== null) {
         var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ja',
        navLinks: true,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        businessHours: true,
        editable: true,
        selectable: true,
        eventClick: function(info){

          $.ajax({
            url: "/plans/" + info.event.id +"/edit.js",
            type: "GET",
          })
            .done(function (data, textStatus, jqXHR) {
            })
            .fail(function() {
            });
          },

        eventSources: [
          {
            url: '/plans.json', // use the `url` property
            color: '#007bff',    // an option!
            textColor: 'white'  // an option!
          },
          {
            url: '/tasks.json',
            color: 'yellow',
            textColor: 'black'
          }
        ]
      });

      calendar.render();
      }

    });
    function reloadcalendar()
    { var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        locale: 'ja',
        navLinks: true,
        businessHours: true,
        editable: true,
        selectable: true,


        events: '/plans.json'
      });
      calendar.render();}
  </script>


